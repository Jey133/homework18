<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>homework18</title>
</head>
<body>

<div id="film" class="films"></div>
	
<script>

let shipsArr = [];
let filmsArr = [];

function fetchData () {
	let filmData = fetch('https://swapi.co/api/films/');
	filmData.then(response => response.json())
	.then(res => generateList(res.results));

	let shipData = fetch('https://swapi.co/api/ships/');
	shipData.then(response => response.json())
	.then(res => shipsArr[res.results]);
};

function generateList (arr) {
	filmsArr[arr];
	let films = document.getElementById('film');
	let filmsList = document.createElement('ul');
	let list ="";

	for (let i = 0; i < arr.length; i++) {

		const filmItem = document.createElement('li');
		const filmItemContent = document.createElement('span');
		filmItemContent.innerText = arr[i].title;

    	filmItem.appendChild(filmItemContent);
   		filmItem.setAttribute('data-id', arr[i].title);		
		filmItem.addEventListener('click', (e) => {
			let filmName = e.currentTarget.getAttribute('data-id');
			getShipsList(filmName, filmItem);
		});
		filmsList.append(filmItem);
	};
	film.append(filmsList);
};

function getShipsList (filmName, filmItem) {
	for (let i = 0; i < filmsArr.length; i++) {
		let filmShipsList = document.createElement('ul');
		if(filmsArr[i].title === filmName){
			let filmShipArr = filmsArr[i].starships;
			for (let j = 0; j < filmShipArr.length; j++) {
				for (let k = 0; k < shipsArr.length; k++) {
					if(filmShipArr[j] === shipsArr[k].url ) {
						const shipItem = document.createElement('li');
						const shipItemContent = document.createElement('span');
						shipItemContent.innerText = shipsArr[k].name;

				    	shipItem.appendChild(shipItemContent);
						filmShipsList.append(shipItem);
					}
				}
			}
		}
	}
	filmItem.append(filmShipsList);
};

console.log(fetchData());

</script>

</body>
</html>